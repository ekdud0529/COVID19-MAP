<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>코로나맵</title>
    <link rel="stylesheet" href="mapstyle.css">
</head>

<body>
    <div id="map" style="width:100%;height:100vh;"></div>
    <p style="margin-top:-12px">
        <em class="link">
            <a href="/web/documentation/#CategoryCode" target="_blank">카테고리 코드목록을 보시려면 여기를 클릭하세요!</a>
        </em>
    </p>
    <div class="map_wrap">
        <div id="map" style="width:100%;height:100%;position:relative;overflow:hidden;"></div>
        <ul id="category">
            <li id="PM9" data-order="2">
                <span class="category_bg pharmacy"></span>
                보건소
            </li>
        </ul>
    </div>
    <script
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=b7b96572f74449457d03127a926f0bd8&libraries=clusterer"></script>
    <script>
        var healthCenter = [
            new kakao.maps.LatLng(35.81579098110627, 127.14317379788938),
            new kakao.maps.LatLng(35.978462970297166, 126.72157312261947),
            new kakao.maps.LatLng(35.96122411413994, 126.96630885185414),
            new kakao.maps.LatLng(35.57826259623523, 126.85471369788279),
            new kakao.maps.LatLng(35.39792963110389, 127.36370578438748),
            new kakao.maps.LatLng(35.80101161859347, 126.88337447090868),
            new kakao.maps.LatLng(35.92143800319691, 127.09255953836285),
            new kakao.maps.LatLng(35.79567510491254, 127.43387338254236),
            new kakao.maps.LatLng(36.00615143371527, 127.67174128440458),
            new kakao.maps.LatLng(35.65457650183054, 127.51980272103197),
            new kakao.maps.LatLng(35.61297366918293, 127.28726092486394),
            new kakao.maps.LatLng(35.367075657228035, 127.14055601322336),
            new kakao.maps.LatLng(35.44402978728154, 126.68327909070189),
            new kakao.maps.LatLng(35.723050373993786, 126.73586738254023)
        ];

        //마커를 클릭했을 때 해당 장소의 상세정보를 보여줄 커스텀오버레이
        var placeOverlay = new kakao.maps.CustomOverlay({ zIndex: 1 }),
            contentNode = document.createElement('div'), // 커스텀 오버레이의 컨텐츠 엘리먼트 입니다 
            markers = [], // 마커를 담을 배열입니다
            currCategory = ''; // 현재 선택된 카테고리를 가지고 있을 변수입니다

        var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
            mapOption = {
                center: new kakao.maps.LatLng(35.845433, 127.124200), // 지도의 중심좌표 전주
                level: 5, // 지도의 확대 레벨
                mapTypeId: kakao.maps.MapTypeId.ROADMAP // 지도종류
            };

        // 지도를 생성한다 
        var map = new kakao.maps.Map(mapContainer, mapOption);

        


        // ///// 지역별 주소-좌표(마커) 변환 /////
        // // 주소-좌표 변환 객체를 생성합니다
        // var geocoder = new kakao.maps.services.Geocoder();
        

        // ////함수로 구현 하기////
        // // 주소로 좌표를 검색합니다
        // geocoder.addressSearch('제주특별자치도 제주시 첨단로 242', function (result, status) {

        //     // 정상적으로 검색이 완료됐으면 
        //     if (status === kakao.maps.services.Status.OK) {

        //         var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

        //         // 결과값으로 받은 위치를 마커로 표시합니다
        //         var marker = new kakao.maps.Marker({
        //             map: map,
        //             position: coords
        //         });

        //         // 인포윈도우로 장소에 대한 설명을 표시합니다
        //         // 장소 설명에 확진자 번호 넣기?
        //         var infowindow = new kakao.maps.InfoWindow({
        //             content: '<div style="width:150px;text-align:center;padding:6px 0;">우리회사</div>'
        //         });
        //         infowindow.open(map, marker);

        //         // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
        //         map.setCenter(coords);
        //     }
        // });









        // 마커 클러스터러를 생성합니다 
        var clusterer = new kakao.maps.MarkerClusterer({
            map: map, // 마커들을 클러스터로 관리하고 표시할 지도 객체 
            averageCenter: true, // 클러스터에 포함된 마커들의 평균 위치를 클러스터 마커 위치로 설정 
            minLevel: 8 // 클러스터 할 최소 지도 레벨 
        });

        // for을 이용한 다양한 처리
        var markers = [];
        var markerlist = [
            [35.845433, 127.125151, '<div style="padding:5px;">전주 470번 확진자</div>'],
            [35.850546, 127.126048, '<div style="padding:5px;">전주 471번 확진자</div>'],
            [35.842726, 127.128126, '<div style="padding:5px;">전주 472번 확진자</div>'],

        ]

        for (var i = 0; i < markerlist.length; i++) {
            //마커 표시하기
            // 마커가 표시될 위치입니다 
            var markerPosition = new kakao.maps.LatLng(markerlist[i][0], markerlist[i][1]);

            // 마커를 생성합니다
            var marker = new kakao.maps.Marker({
                position: markerPosition
            });

            // 마커가 지도 위에 표시되도록 설정합니다
            marker.setMap(map);

            var iwContent = markerlist[i][2], // 인포윈도우에 표출될 내용으로 HTML 문자열이나 document element가 가능합니다
                iwPosition = new kakao.maps.LatLng(markerlist[i][0], markerlist[i][1]); //인포윈도우 표시 위치입니다

            // 인포윈도우를 생성합니다
            var infowindow = new kakao.maps.InfoWindow({
                content: iwContent
            });

            //---마커 위에 인포윈도우를 표시합니다. 두번째 파라미터인 marker를 넣어주지 않으면 지도 위에 표시됩니다
            //---infowindow.open(map, marker);

            ////클러스터러에 사용할 정보 저장
            markers.push(marker);

            ////여러개의 마커에 이벤트 등록과정 中 1
            kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
            kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
        }



        // 지도 타입 변경 컨트롤을 생성한다
        var mapTypeControl = new kakao.maps.MapTypeControl();

        // 지도의 상단 우측에 지도 타입 변경 컨트롤을 추가한다
        map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

        // 지도에 확대 축소 컨트롤을 생성한다
        var zoomControl = new kakao.maps.ZoomControl();

        // 지도의 우측에 확대 축소 컨트롤을 추가한다
        map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

        // 클러스터러에 마커들을 추가합니다
        clusterer.addMarkers(markers);

        // 인포윈도우를 표시하는 클로저를 만드는 함수입니다 
        function makeOverListener(map, marker, infowindow) {
            return function () {
                infowindow.open(map, marker);
            };
        }

        // 인포윈도우를 닫는 클로저를 만드는 함수입니다 
        function makeOutListener(infowindow) {
            return function () {
                infowindow.close();
            };
        }




    </script>
</body>

</html>